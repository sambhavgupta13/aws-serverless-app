version: 0.2
phases:
  install:
      runtime-versions:
        nodejs: 18
      commands:
        - ls -a
        - ls -R
        - node -v
        - npm run install:frontend
        - npm run install:server
  build:
    commands:
      - echo $STAGE_NAME
      - chmod +x ./infrastructure/sam_dls.sh
      - |
        if [ "$STAGE_NAME" == "BUILD" ]; then
          echo "Running build-specific commands"
          ./infrastructure/sam_dls.sh build 
          ./infrastructure/sam_dls.sh package
        elif [ "$STAGE_NAME" == "DEPLOY" ]; then
          echo "Running deploy-specific commands"
          ./infrastructure/sam_dls.sh deploy 
        else
          echo "Unknown stage"
          exit 1
        fi

cache:
  paths:
    - frontend/dist/**/*
    - .aws-sam/build/template.yaml